<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Daily Register | Cloud Sync</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
    <style>
        :root { --primary: #0288d1; --dark: #01579b; --green: #2e7d32; --red: #c62828; --bg: #f0f4f8; --white: #ffffff; }
        * { box-sizing: border-box; font-family: 'Segoe UI', sans-serif; }
        body { background: var(--bg); margin: 0; padding: 20px; color: #333; }
        
        .header { display: flex; justify-content: space-between; align-items: center; margin-bottom: 20px; background: var(--white); padding: 20px; border-radius: 10px; box-shadow: 0 2px 10px rgba(0,0,0,0.05); border-left: 5px solid var(--primary); }
        .header h1 { margin: 0; font-size: 24px; color: var(--dark); }
        .header p { margin: 0; color: #666; font-size: 14px; }
        
        .cloud-badge { background: #e8f5e9; color: var(--green); padding: 5px 10px; border-radius: 20px; font-size: 12px; font-weight: bold; display: flex; align-items: center; gap: 5px; }

        .dashboard { display: grid; grid-template-columns: repeat(3, 1fr); gap: 20px; margin-bottom: 30px; }
        .card { background: var(--white); padding: 20px; border-radius: 10px; text-align: center; box-shadow: 0 2px 5px rgba(0,0,0,0.05); }
        .card h3 { margin: 0 0 10px 0; font-size: 14px; color: #666; text-transform: uppercase; }
        .card .amount { font-size: 28px; font-weight: bold; }
        .card.income .amount { color: var(--green); } .card.expense .amount { color: var(--red); } .card.balance .amount { color: var(--primary); }

        .input-form { background: var(--white); padding: 20px; border-radius: 10px; display: flex; gap: 15px; align-items: end; box-shadow: 0 5px 15px rgba(0,0,0,0.05); margin-bottom: 30px; flex-wrap: wrap; }
        .form-group { flex: 1; min-width: 150px; }
        .form-group label { display: block; margin-bottom: 5px; font-size: 12px; font-weight: bold; color: var(--dark); }
        .form-group input, .form-group select { width: 100%; padding: 10px; border: 1px solid #ddd; border-radius: 5px; font-size: 14px; }
        
        .btn-add { background: var(--dark); color: white; border: none; padding: 10px 25px; border-radius: 5px; font-weight: bold; cursor: pointer; height: 42px; transition: 0.3s; min-width: 120px;}
        .btn-add:hover { background: var(--primary); }
        .btn-add:disabled { background: #aaa; cursor: not-allowed; }

        .list-container { background: var(--white); border-radius: 10px; padding: 20px; box-shadow: 0 2px 10px rgba(0,0,0,0.05); }
        table { width: 100%; border-collapse: collapse; }
        th { text-align: left; padding: 12px; background: #f8f9fa; color: #555; font-size: 13px; }
        td { padding: 12px; border-bottom: 1px solid #eee; font-size: 14px; }
        .plus { color: var(--green); font-weight: bold; } .minus { color: var(--red); font-weight: bold; }
        
        @media (max-width: 768px) { .dashboard { grid-template-columns: 1fr; } .input-form { flex-direction: column; align-items: stretch; } }
    </style>
</head>
<body>

    <div class="header">
        <div>
            <h1>Daily Register</h1>
            <p>Shree Ashtavinayak Glass</p>
        </div>
        <div class="cloud-badge"><i class="fas fa-cloud-upload-alt"></i> Connected to Google Sheets</div>
    </div>

    <div class="dashboard">
        <div class="card income"><h3>Income</h3><div class="amount">₹ <span id="totalIncome">0</span></div></div>
        <div class="card expense"><h3>Expense</h3><div class="amount">₹ <span id="totalExpense">0</span></div></div>
        <div class="card balance"><h3>Profit</h3><div class="amount">₹ <span id="netBalance">0</span></div></div>
    </div>

    <div class="input-form">
        <div class="form-group"><label>Date</label><input type="date" id="date"></div>
        <div class="form-group"><label>Type</label>
            <select id="type"><option value="income">Income</option><option value="expense">Expense</option></select>
        </div>
        <div class="form-group"><label>Category</label>
            <select id="category">
                <option value="Sales">Sales / Advance</option><option value="Raw Material">Raw Material</option>
                <option value="Labor">Labor</option><option value="Transport">Transport</option>
                <option value="Misc">Misc / Office</option>
            </select>
        </div>
        <div class="form-group" style="flex: 2;"><label>Description</label><input type="text" id="desc" placeholder="Details..."></div>
        <div class="form-group"><label>Amount (₹)</label><input type="number" id="amount" placeholder="0"></div>
        <button class="btn-add" id="saveBtn" onclick="addTransaction()">Save to Cloud</button>
    </div>

    <div class="list-container">
        <h3 style="margin-top:0;">Recent Transactions (Local View)</h3>
        <table>
            <thead><tr><th>Date</th><th>Category</th><th>Description</th><th>Amount</th></tr></thead>
            <tbody id="list"></tbody>
        </table>
    </div>

    <script>
        const SCRIPT_URL = "https://script.google.com/macros/s/AKfycbyc-H7zkyvOx4I4zvbyEsdkmDkRHLzf8L_zy9-PMje4Hk4Z3ZYvVnghzDZolnLW6nyI/exec";
        let transactions = JSON.parse(localStorage.getItem('cloud_accounts')) || [];
        document.getElementById('date').valueAsDate = new Date();

        function updateUI() {
            const list = document.getElementById('list');
            list.innerHTML = '';
            let inc = 0, exp = 0;

            transactions.forEach(t => {
                let amt = parseFloat(t.amount);
                if (t.type === 'income') inc += amt; else exp += amt;
                list.innerHTML += `<tr><td>${t.date}</td><td>${t.category}</td><td>${t.desc}</td>
                <td class="${t.type === 'income' ? 'plus' : 'minus'}">${t.type === 'income' ? '+' : '-'} ₹${amt}</td></tr>`;
            });
            document.getElementById('totalIncome').innerText = inc.toLocaleString();
            document.getElementById('totalExpense').innerText = exp.toLocaleString();
            document.getElementById('netBalance').innerText = (inc - exp).toLocaleString();
            localStorage.setItem('cloud_accounts', JSON.stringify(transactions));
        }

        function addTransaction() {
            const date = document.getElementById('date').value;
            const type = document.getElementById('type').value;
            const category = document.getElementById('category').value;
            const desc = document.getElementById('desc').value;
            const amount = document.getElementById('amount').value;

            if(!desc || !amount) { alert('Enter description and amount'); return; }

            const btn = document.getElementById('saveBtn');
            btn.innerHTML = '<i class="fas fa-spinner fa-spin"></i> Saving...';
            btn.disabled = true;

            const payload = { sheetName: "Daily_Transactions", date: date, type: type, category: category, desc: desc, amount: amount };

            fetch(SCRIPT_URL, {
                method: 'POST',
                body: JSON.stringify(payload)
            }).then(response => {
                transactions.unshift(payload); // Save locally for UI
                updateUI();
                document.getElementById('desc').value = '';
                document.getElementById('amount').value = '';
                btn.innerHTML = 'Save to Cloud';
                btn.disabled = false;
            }).catch(error => {
                alert("Error connecting to Google Sheets.");
                btn.innerHTML = 'Save to Cloud';
                btn.disabled = false;
            });
        }
        updateUI();
    </script>
</body>
</html>
